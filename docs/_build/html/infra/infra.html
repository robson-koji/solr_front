

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Infraestrutura &mdash; Documentação Solr Font 0.1</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Índice"
              href="../genindex.html"/>
        <link rel="search" title="Pesquisar" href="../search.html"/>
    <link rel="top" title="Documentação Solr Font 0.1" href="../index.html"/>
        <link rel="next" title="Collections relacionadas" href="../intro/coll_rela.html"/>
        <link rel="prev" title="Configuração" href="../install/config.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Solr Font
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/intro.html">Introdução</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/util.html">Utilização</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/install.html">Instalação</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/config.html">Configuração</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Infraestrutura</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#solr">Solr</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#criar-collection-shards-replicas-solrconfig-xml">Criar collection (shards, réplicas, solrconfig.xml)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#campos-dinamicos">Campos dinâmicos</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#verificar-separador-dos-campos-de-facet">Verificar separador dos campos de facet</a></li>
<li class="toctree-l3"><a class="reference internal" href="#campos-para-busca">Campos para busca</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#descricao-do-caso-de-uso">Descrição do caso de uso</a></li>
<li class="toctree-l4"><a class="reference internal" href="#descricao-tecnica">Descrição técnica</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#campos-para-nuvem-de-palavras">Campos para nuvem de palavras</a></li>
<li class="toctree-l3"><a class="reference internal" href="#campos-para-exportacao">Campos para exportação</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../intro/coll_rela.html">Collections relacionadas</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Solr Font</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Infraestrutura</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/infra/infra.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="infraestrutura">
<span id="infraestrutura"></span><h1>Infraestrutura<a class="headerlink" href="#infraestrutura" title="Link permanente para este título">¶</a></h1>
<div class="section" id="solr">
<span id="solr"></span><h2>Solr<a class="headerlink" href="#solr" title="Link permanente para este título">¶</a></h2>
<div class="section" id="criar-collection-shards-replicas-solrconfig-xml">
<span id="criar-collection-shards-replicas-solrconfig-xml"></span><h3>Criar collection (shards, réplicas, solrconfig.xml)<a class="headerlink" href="#criar-collection-shards-replicas-solrconfig-xml" title="Link permanente para este título">¶</a></h3>
<div class="section" id="campos-dinamicos">
<span id="campos-dinamicos"></span><h4>Campos dinâmicos<a class="headerlink" href="#campos-dinamicos" title="Link permanente para este título">¶</a></h4>
<p>É possível escolher a criação de campos dinâmicos quando os mesmos seguirem um regra de tipagem igual, ou compatível. Por exemplo, quando não for necessário utilizar tipo numérico, que é mais eficiente em termos de busca, e o mesmo puder ser definido como tipo string para ser compatível com outros campos dinâmicos.
Campos a serem facetados não podem ser definidos dinamicamente. (ver abaixo)</p>
<p>Exemplo “dynamicField”</p>
<p><dynamicField name="GRADUACAO*" type="string" multiValued="true" indexed="true" stored="true"/></p>
</div>
</div>
<div class="section" id="verificar-separador-dos-campos-de-facet">
<span id="verificar-separador-dos-campos-de-facet"></span><h3>Verificar separador dos campos de facet<a class="headerlink" href="#verificar-separador-dos-campos-de-facet" title="Link permanente para este título">¶</a></h3>
<p>Os campos a serem facetados devem ser separados pelo caracter “|” no arquivo que será carregado no Solr.
Os mesmos deverão ser do tipo “descendant_path” como no exemplo abaixo:</p>
<p>Exemplo “fieldType”</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">fieldType</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;descendent_path&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;solr.TextField&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">analyzer</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">tokenizer</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;solr.PathHierarchyTokenizerFactory&quot;</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;|&quot;</span> <span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="n">analyzer</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">analyzer</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;query&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">tokenizer</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;solr.KeywordTokenizerFactory&quot;</span> <span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="n">analyzer</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">fieldType</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Exemplo “descendent_path”</p>
<p><field name="GRADUACAO_AREAS-DO-CONHECIMENTO_FACET" multiValued="true" type="descendent_path"/></p>
</div>
<div class="section" id="campos-para-busca">
<span id="campos-para-busca"></span><h3>Campos para busca<a class="headerlink" href="#campos-para-busca" title="Link permanente para este título">¶</a></h3>
<p>Campo apresentado na busca avançada do sistema.
Do ponto de vista do usuário, ele escolhe o campo onde será efetuada uma busca, como nos exemplos abaixo, do Lattes e de Projetos da BV respectivamente.</p>
<div class="section" id="descricao-do-caso-de-uso">
<span id="descricao-do-caso-de-uso"></span><h4>Descrição do caso de uso<a class="headerlink" href="#descricao-do-caso-de-uso" title="Link permanente para este título">¶</a></h4>
<ol class="simple">
<li>Usuário escolhe um campo para busca.</li>
<li>Usuário começa a digitar</li>
<li>Sistema retorna lista de facets, montanto uma “lista autocomplete”</li>
<li>Usuário seleciona um item apresentado no autocomplete.</li>
<li>Sistema realiza busca no campo buscável com o valor selecionado no autocomplete.</li>
</ol>
</div>
<div class="section" id="descricao-tecnica">
<span id="descricao-tecnica"></span><h4>Descrição técnica<a class="headerlink" href="#descricao-tecnica" title="Link permanente para este título">¶</a></h4>
<p>Tecnicamente dois campos são indexados com tipos diferentes, sendo que um deles é utilizado para a busca e outro é utilizado para a apresentação no autocomplete.
Essa implementação pode ser feita como descrito nos exemplos abaixo:</p>
<p>Campo original, que é apresentado no autocomplete:</p>
<p><field name="ATIVIDADES-DE-ENSINO_DISCIPLINAS" type="strings"/></p>
<p>Definir um tipo que será utilizado como campo de busca:</p>
<p><fieldType name="text_busca" class="solr.TextField" sortMissingLast="true" positionIncrementGap="100">
<analyzer type="index">
<tokenizer class="solr.StandardTokenizerFactory"/>
<filter class="solr.SynonymFilterFactory" synonyms="synonyms.txt" ignoreCase="true" expand="true"/>
<filter class="solr.StopFilterFactory" ignoreCase="true" words="lang/stopwords_pt.txt" format="snowball" />
<filter class="solr.WordDelimiterFilterFactory" generateWordParts="1" generateNumberParts="1" catenateWords="1" catenateNumbers="1" catenateAll="0"/>
<filter class="solr.ASCIIFoldingFilterFactory"/>
<filter class="solr.LowerCaseFilterFactory"/>
<filter class="solr.EdgeNGramFilterFactory" minGramSize="1" maxGramSize="18"/>
<filter class="solr.PortugueseLightStemFilterFactory"/>
<filter class="solr.RemoveDuplicatesTokenFilterFactory"/>
</analyzer>
<analyzer type="query">
<tokenizer class="solr.StandardTokenizerFactory"/>
<filter class="solr.SynonymFilterFactory" synonyms="synonyms.txt" ignoreCase="true" expand="true"/>
<filter class="solr.StopFilterFactory" ignoreCase="true" words="lang/stopwords_pt.txt" format="snowball" />
<filter class="solr.WordDelimiterFilterFactory" generateWordParts="1" generateNumberParts="1" catenateWords="0" catenateNumbers="0" catenateAll="0"/>
<filter class="solr.ASCIIFoldingFilterFactory"/>
<filter class="solr.LowerCaseFilterFactory"/>
<filter class="solr.PortugueseLightStemFilterFactory"/>
<filter class="solr.RemoveDuplicatesTokenFilterFactory"/>
</analyzer>
</fieldType></p>
<p>Definir um campo dinâmico que possa ser utilizado em todos os campos de busca.</p>
<p><dynamicField name="*_busca" type="text_busca" multiValued="true" indexed="true" stored="true"/></p>
<p>Fazer uma cópia do campo original, para o campo buscável</p>
<p><copyField source="ATIVIDADES-DE-ENSINO_DISCIPLINAS" dest="ATIVIDADES-DE-ENSINO_DISCIPLINAS_busca"/></p>
<p>Existe também a possibilidade de apenas atribuir ao campo que se deseja buscar, o type=text, como no exemplo a seguir:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">field</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;abstract&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p>E adicionar ao conf da collection os parametros do QueryBuilder, conforme exemplo abaixo:</p>
<p>{
«get_from_solr_field»: «abstract»,
«label»: «Resumo»,
«operators»: [«equal», «not_equal»],
«input»: «autocomplete»,
«solr_params»: {
«q» : «<em>:</em>»,
«fl» : «*»,
«rows»: «20»,
«field»: «abstract»,
«facet_field» : «abstract»</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>         <span class="p">}</span> <span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
      <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="campos-para-nuvem-de-palavras">
<span id="campos-para-nuvem-de-palavras"></span><h3>Campos para nuvem de palavras<a class="headerlink" href="#campos-para-nuvem-de-palavras" title="Link permanente para este título">¶</a></h3>
<p>Definir o campo original que será copiado para gerar nuvem de palavras, pois não é possível copiar um campo que não existe.</p>
<p>Criar o campo que será utilzado para gerar nuvem de palavras</p>
<p><field name="campo_nuvem_palavras" type="text_gen_stopword"  multiValued="true" indexed="true" stored="true"/></p>
<p>Copiar o campo que será utilizado na nuvem de palavras:</p>
<p>&lt;copyField source=»original» dest=”campo_nuvem_palavras»/&gt;</p>
<p>Definir o tipo do campo que é utilizado na nuvem de palavras:</p>
<p><fieldType name="text_gen_stopword" class="solr.TextField" positionIncrementGap="100">
<analyzer type="index">
<tokenizer class="solr.StandardTokenizerFactory"/>
<filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt" />
<filter class="solr.LowerCaseFilterFactory"/>
</analyzer>
<analyzer type="query">
<tokenizer class="solr.StandardTokenizerFactory"/>
<filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt" />
<filter class="solr.LowerCaseFilterFactory"/>
</analyzer>
</fieldType></p>
</div>
<div class="section" id="campos-para-exportacao">
<span id="campos-para-exportacao"></span><h3>Campos para exportação<a class="headerlink" href="#campos-para-exportacao" title="Link permanente para este título">¶</a></h3>
<p>Todos os campos que serão exportados devem ser definidos com docValues=true no schema.</p>
<p>Front-end
Componentes</p>
<p>Facet
Transformação na view dos dados utilizados no facet no front-end</p>
<p>Exemplos do formato do dado facetado recebido do Solr:
(Pdb) solr_json[“facets”][“AREAS-DO-CONHECIMENTO-DE-ATUACAO_FACET”][“buckets”][0]
{u’count”: 10232, u’val”: u’CIENCIAS_BIOLOGICAS”}</p>
<p>Exemplos do formato do dado facetado enviado para o fron-end:
(Pdb) solr_json[“facet_counts”][“hierarquico”][“AREAS-DO-CONHECIMENTO-DE-ATUACAO_FACET”][“facets”][“LINGUISTICA_LETRAS_E_ARTES”][“facets”][“Artes”][“facets”][“Artes”]
{“chave”: u’LINGUISTICA_LETRAS_E_ARTES|Artes|Artes”, “count”: 11, “facets”: {}, “label”: “Artes”}</p>
<p>(Pdb) solr_json[“facet_counts”][“hierarquico”][“DOUTORADO_AREAS-DO-CONHECIMENTO_FACET”]
{“count”: 5, “facets”: {u’ENGENHARIAS”: {“chave”: u’ENGENHARIAS”, “count”: 2, “facets”: {u’Engenharia de Materiais e Metal\xfargica”: {“chave”: u’ENGENHARIASEngenharia de Materiais e Metal\xfargica”, “count”: 1, “facets”: {u’Materiais N\xe3o-Met\xe1licos”: {“chave”: u’ENGENHARIAS|Engenharia de Materiais e Metal\xfargica|Materiais N\xe3o-Met\xe1licos”, “count”: 1, “facets”: {}, “label”: “Materiais N\xc3\xa3oMet\xc3\xa1licos”}}, “label”: “Engenharia de Materiais e Metal\xc3\xbargica”}, u’Engenharia Aeroespacial”: {“chave”: u’ENGENHARIASEngenharia Aeroespacial”, “count”: 1, “facets”: {u’Materiais e Processos para Engenharia Aeron\xe1utica e Aeroespacial”: {“chave”: u’ENGENHARIAS|Engenharia Aeroespacial|Materiais e Processos para Engenharia Aeron\xe1utica e Aeroespacial”, “count”: 1, “facets”: {}, “label”: “Materiais e Processos para Engenharia Aeron\xc3\xa1utica e Aeroespacial”}}, “label”: “Engenharia Aeroespacial”}, u’N\xe3o identificado”: {“chave”: u’ENGENHARIASN\xe3o identificado”, “count”: 1, “facets”: {u’Materiais El\xe9tricos”: {“chave”: u’ENGENHARIAS|N\xe3o identificado|Materiais El\xe9tricos”, “count”: 1, “facets”: {}, “label”: “Materiais El\xc3\xa9tricos”}}, “label”: “N\xc3\xa3o identificado”}}, “label”: “ENGENHARIAS”}, u’OUTROS”: {“chave”: u’OUTROS”, “count”: 1, “facets”: {u’Microeletr\xf4nica”: {“chave”: u’OUTROSMicroeletr\xf4nica”, “count”: 1, “facets”: {u’Dispositivos”: {“chave”: u’OUTROS|Microeletr\xf4nica|Dispositivos”, “count”: 1, “facets”: {}, “label”: “Dispositivos”}}, “label”: “Microeletr\xc3\xb4nica”}}, “label”: “OUTROS”}, u’CIENCIAS_EXATAS_E_DA_TERRA”: {“chave”: u’CIENCIAS_EXATAS_E_DA_TERRA”, “count”: 2, “facets”: {u’N\xe3o identificado”: {“chave”: u’CIENCIAS_EXATAS_E_DA_TERRAN\xe3o identificado”, “count”: 2, “facets”: {u’F\xedsica da Mat\xe9ria Condensada”: {“chave”: u’CIENCIAS_EXATAS_E_DA_TERRA|N\xe3o identificado|F\xedsica da Mat\xe9ria Condensada”, “count”: 2, “facets”: {}, “label”: “F\xc3\xadsica da Mat\xc3\xa9ria Condensada”}}, “label”: “N\xc3\xa3o identificado”}}, “label”: “CIENCIAS_EXATAS_E_DA_TERRA”}}, “groupBy”: {“order”: 5, “id”: “doutorado”, “label”: “Doutorado”}, “chave”: “DOUTORADO_AREAS-DO-CONHECIMENTO_FACET”, “label”: “\xc3\x81rea do conhecimento”, “order”: 5}</p>
<p>Collections relacionadas
A estrutura de Grafo do buscador permite que collections sejam relacionadas através de campos com valores comuns. Desta maneira elas podem ser trabalhandas em conjunto no sistema.
conf.py
As collections se relacionam através de campos determinados no dicionário  EDGES do arquivo conf.py.</p>
<p>Tomo como exemplo abaixo que Col4 é um subconjunto de Col 1.</p>
<p>Para implementar o uso das collections relacionadas no sistema, dois processos principais foram estabelecidos e serão descritos abaixo, sendo eles a “Contabilização da quantidade dos objetos relacionas” e o processo de apresentação de “Sub-collections”.</p>
<p>Contabilização da quantidade dos objetos relacionados
Este processo de contabilização existe para apresentar o “join” das collections relacionadas, como no exemplo abaixo:</p>
<p>Quando a página de uma collection do buscador é carregada, um Ajax chama a view RelatedCollection que recupera todas as collections relacionadas a collection em questão, para montar a apresentação conforme indicado acima.</p>
<p>views.py
A view utilizada neste processo é a RelatedCollections, que faz as verificações dos relacionamentos citados acima, e a função get_or_create_related_collection_db é quem efetivamente contabiliza, e armazena as informações de contabilização.
As quantidades de cada relacionamento são “cacheadas” em banco de dados para que o processo de contabilização das quantidades dos relacionamentos não precise ser executado sempre.</p>
<p>Sub-collection
A quantidade dos registros que fazerm parte de um relacionamento entre duas collections é apresentada no exemplo da figura abaixo, conforme já explicado anterioremente.</p>
<p>O link abaixo direciona para o subconjunto da collection B que faz interseção com a Collection A.</p>
<p>Para que seja possível acessar o subconjunto da collection B que faz intersecção com a collection A, é necessário indexar os registros da collection B com um marcador dessa intersecção. O subconjunto da collection B é o que chamamos de sub-collection.</p>
<p>Portanto ao clicar no link acima, a view AddVerticeView é acessada para cuidar do processo de reinidexação.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../intro/coll_rela.html" class="btn btn-neutral float-right" title="Collections relacionadas" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../install/config.html" class="btn btn-neutral" title="Configuração" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>